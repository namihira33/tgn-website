---
import BaseLayout from '../../layouts/BaseLayout.astro';
import SectionHeader from '../../components/ui/SectionHeader.astro';

const donationOptions = [
  {
    amount: 100,
    label: '100å††',
    description: 'ã¡ã‚‡ã£ã¨ã—ãŸå¿œæ´ã«',
    icon: 'â˜•'
  },
  {
    amount: 500,
    label: '500å††',
    description: 'ã‚¤ãƒ™ãƒ³ãƒˆé‹å–¶è²»ã®ä¸€éƒ¨ã«',
    icon: 'ğŸ‰'
  },
  {
    amount: 1000,
    label: '1,000å††',
    description: 'TGNã®æ´»å‹•ã‚’å¤§ããæ”¯æ´',
    icon: 'ğŸŒŸ'
  }
];
---

<BaseLayout title="å¯„ä»˜ã§å¿œæ´" description="ã¤ãã°é™¢ç”Ÿãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆTGNï¼‰ã®æ´»å‹•ã‚’å¯„ä»˜ã§å¿œæ´ã—ã¦ãã ã•ã„ã€‚">
  <!-- Hero -->
  <section class="bg-gradient-to-br from-primary/10 to-primary-light/20 py-16 md:py-24">
    <div class="container">
      <h1 class="text-3xl md:text-4xl font-bold text-text mb-6">
        TGNã‚’å¿œæ´ã™ã‚‹
      </h1>
      <p class="text-lg text-text-muted max-w-2xl">
        TGNã¯å¤§å­¦é™¢ç”Ÿã«ã‚ˆã‚‹éå–¶åˆ©ã®å­¦ç”Ÿå›£ä½“ã§ã™ã€‚<br />
        çš†æ§˜ã‹ã‚‰ã®ã”å¯„ä»˜ã¯ã€ã‚¤ãƒ™ãƒ³ãƒˆé‹å–¶ã‚„ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ´»å‹•ã«æ´»ç”¨ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚
      </p>
    </div>
  </section>

  <!-- Donation Options -->
  <section class="section">
    <div class="container">
      <SectionHeader
        title="å¯„ä»˜é‡‘é¡ã‚’é¸ã¶"
        subtitle="ãŠå¥½ããªé‡‘é¡ã§TGNã‚’å¿œæ´ã—ã¦ãã ã•ã„"
        align="center"
      />

      <div class="grid md:grid-cols-3 gap-6 max-w-4xl mx-auto mb-12">
        {donationOptions.map((option, index) => (
          <button
            type="button"
            class="donation-option card p-8 text-center cursor-pointer transition-all hover:scale-105 hover:shadow-lg border-2 border-transparent hover:border-primary focus:outline-none focus:border-primary"
            data-amount={option.amount}
          >
            <div class="text-4xl mb-4">{option.icon}</div>
            <div class="text-3xl font-bold text-primary mb-2">{option.label}</div>
            <p class="text-sm text-text-muted">{option.description}</p>
          </button>
        ))}
      </div>

      <div class="max-w-md mx-auto text-center">
        <p class="text-sm text-text-muted mb-6">
          â€» Stripeã®å®‰å…¨ãªæ±ºæ¸ˆãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¾ã™
        </p>

        <div id="selected-amount" class="hidden mb-6 p-4 bg-primary/10 rounded-lg">
          <p class="text-lg">é¸æŠä¸­: <span class="font-bold text-primary" id="amount-display"></span></p>
        </div>

        <button
          id="donate-button"
          disabled
          class="btn btn-primary w-full py-4 text-lg disabled:opacity-50 disabled:cursor-not-allowed"
        >
          å¯„ä»˜ã™ã‚‹
        </button>
      </div>
    </div>
  </section>

  <!-- How funds are used -->
  <section class="section bg-gray-50">
    <div class="container">
      <SectionHeader
        title="å¯„ä»˜é‡‘ã®ä½¿ã„é“"
        subtitle="çš†æ§˜ã‹ã‚‰ã®ã”æ”¯æ´ã¯ä»¥ä¸‹ã®æ´»å‹•ã«æ´»ç”¨ã•ã‚Œã¾ã™"
        align="center"
      />

      <div class="grid md:grid-cols-3 gap-6 max-w-4xl mx-auto">
        <div class="bg-white p-6 rounded-lg shadow-sm text-center">
          <div class="text-3xl mb-3">ğŸ¤</div>
          <h3 class="font-bold mb-2">ã‚¤ãƒ™ãƒ³ãƒˆé‹å–¶è²»</h3>
          <p class="text-sm text-text-muted">é™¢ç”Ÿã²ã‚ã°ã€é™¢ç”Ÿã®è™ãªã©ã®ä¼šå ´è²»ãƒ»é‹å–¶è²»</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm text-center">
          <div class="text-3xl mb-3">ğŸŒ¸</div>
          <h3 class="font-bold mb-2">äº¤æµã‚¤ãƒ™ãƒ³ãƒˆè²»</h3>
          <p class="text-sm text-text-muted">é™¢ç”ŸèŠ±è¦‹ãªã©ã®äº¤æµã‚¤ãƒ™ãƒ³ãƒˆé–‹å‚¬è²»ç”¨</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm text-center">
          <div class="text-3xl mb-3">ğŸ’»</div>
          <h3 class="font-bold mb-2">åºƒå ±ãƒ»é‹å–¶åŸºç›¤</h3>
          <p class="text-sm text-text-muted">ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆé‹å–¶ã€åºƒå ±æ´»å‹•è²»ç”¨</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Thank you message -->
  <section class="section">
    <div class="container text-center">
      <p class="text-lg text-text-muted max-w-2xl mx-auto">
        TGNã¯2011å¹´ã®è¨­ç«‹ä»¥æ¥ã€å¤§å­¦é™¢ç”Ÿã®ã¤ãªãŒã‚Šã‚’ä½œã‚Šç¶šã‘ã¦ãã¾ã—ãŸã€‚<br />
        çš†æ§˜ã®ã”æ”¯æ´ãŒã€æ¬¡ã®ä¸–ä»£ã®é™¢ç”Ÿã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚’æ”¯ãˆã¾ã™ã€‚<br />
        æ¸©ã‹ã„ã”æ”¯æ´ã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚
      </p>
    </div>
  </section>
</BaseLayout>

<script>
  let selectedAmount: number | null = null;
  let isProcessing = false;

  const donationOptions = document.querySelectorAll('.donation-option');
  const donateButton = document.getElementById('donate-button') as HTMLButtonElement;
  const selectedAmountDiv = document.getElementById('selected-amount');
  const amountDisplay = document.getElementById('amount-display');

  donationOptions.forEach(option => {
    option.addEventListener('click', () => {
      // Remove selected state from all options
      donationOptions.forEach(opt => {
        opt.classList.remove('border-primary', 'bg-primary/5');
        opt.classList.add('border-transparent');
      });

      // Add selected state to clicked option
      option.classList.remove('border-transparent');
      option.classList.add('border-primary', 'bg-primary/5');

      // Update selected amount
      selectedAmount = parseInt(option.getAttribute('data-amount') || '0');

      // Show selected amount
      if (selectedAmountDiv && amountDisplay) {
        selectedAmountDiv.classList.remove('hidden');
        amountDisplay.textContent = `${selectedAmount.toLocaleString()}å††`;
      }

      // Enable donate button
      donateButton.disabled = false;
    });
  });

  donateButton.addEventListener('click', async () => {
    if (!selectedAmount || isProcessing) return;

    isProcessing = true;
    donateButton.disabled = true;
    donateButton.textContent = 'å‡¦ç†ä¸­...';

    try {
      const response = await fetch('/api/create-checkout', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ amount: selectedAmount })
      });

      const data = await response.json();

      if (data.url) {
        window.location.href = data.url;
      } else {
        throw new Error(data.error || 'æ±ºæ¸ˆã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    } catch (error) {
      console.error('Payment error:', error);
      alert('æ±ºæ¸ˆã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
      donateButton.disabled = false;
      donateButton.textContent = 'å¯„ä»˜ã™ã‚‹';
      isProcessing = false;
    }
  });
</script>
