---
import SectionHeader from '../ui/SectionHeader.astro';
import Badge from '../ui/Badge.astro';
import Button from '../ui/Button.astro';
import { getUnifiedNews, formatDate } from '../../lib/news';

const allNews = await getUnifiedNews();
const latestNews = allNews.slice(0, 3);

function getCategoryLabel(category: string) {
  switch (category) {
    case 'event': return 'イベント';
    case 'note': return 'note';
    default: return 'お知らせ';
  }
}

function getCategoryVariant(category: string): 'primary' | 'secondary' {
  return category === 'event' ? 'secondary' : 'primary';
}
---

<section class="section bg-background">
  <div class="container">
    <SectionHeader title="NEWS" subtitle="最新のお知らせ・イベント情報" />

    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3 mb-8">
      {latestNews.map((news, index) => (
        <a
          href={news.href}
          target={news.isExternal ? '_blank' : undefined}
          rel={news.isExternal ? 'noopener noreferrer' : undefined}
          class="card group fade-in"
          style={`transition-delay: ${index * 100}ms`}
        >
          <div class="p-6">
            <div class="flex items-center gap-2 mb-3">
              <span class={news.category === 'note' ? 'badge-note' : ''}>
                <Badge variant={getCategoryVariant(news.category)}>
                  {getCategoryLabel(news.category)}
                </Badge>
              </span>
              {news.isExternal && (
                <svg class="w-4 h-4 text-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                </svg>
              )}
              <time class="text-sm text-text-muted">
                {formatDate(news.date)}
              </time>
            </div>
            <h3 class="font-bold text-lg text-text group-hover:text-primary transition-colors line-clamp-2">
              {news.title}
            </h3>
            {news.description && (
              <p class="mt-2 text-sm text-text-muted line-clamp-2">
                {news.description}
              </p>
            )}
          </div>
        </a>
      ))}
    </div>

    <div class="text-center">
      <Button href="/news" variant="outline">
        すべてのNEWSを見る
      </Button>
    </div>
  </div>
</section>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .badge-note :global(.badge) {
    background-color: #41C9B4 !important;
    color: white !important;
  }
</style>
